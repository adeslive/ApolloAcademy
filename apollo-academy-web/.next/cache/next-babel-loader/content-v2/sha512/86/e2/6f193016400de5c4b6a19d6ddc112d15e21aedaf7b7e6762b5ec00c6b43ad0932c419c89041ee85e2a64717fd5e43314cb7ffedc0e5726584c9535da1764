{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _slicedToArray from \"C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectDestructuringEmpty from \"C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectDestructuringEmpty\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Usuario\\\\Documents\\\\Proyectos\\\\apollo-academy\\\\apollo-academy-web\\\\pages\\\\course\\\\[pid].tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Box, Button, Flex, Heading, Link, SimpleGrid, Square, Text } from \"@chakra-ui/react\";\nimport { useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport { Form, Formik } from \"formik\";\nimport { withUrqlClient } from \"next-urql\";\nimport NextLink from 'next/link';\nimport { useRouter } from \"next/router\";\nimport React from \"react\";\nimport Classroom from \"../../components/Classroom\";\nimport { Header } from \"../../components/Header\";\nimport Layout from \"../../components/Layout\";\nimport { useCreateCheckoutSessionMutation, useGetClassroomsQuery, useIsPaidQuery } from \"../../generated/graphql\";\nimport { urqlClient } from \"../../utils/urqlClient\";\nimport moment from 'moment';\n\nvar Course = function Course(_ref) {\n  _s();\n\n  _objectDestructuringEmpty(_ref);\n\n  var classroom;\n  var body = null;\n  var formFunc = null;\n  var buyButton = null;\n  var info = null;\n  var classCard = null;\n  var router = useRouter();\n  var pid = router.query.pid;\n  var number = typeof router.query.pid === 'string' ? router.query.pid : '-1';\n\n  var _useCreateCheckoutSes = useCreateCheckoutSessionMutation(),\n      _useCreateCheckoutSes2 = _slicedToArray(_useCreateCheckoutSes, 2),\n      checkout = _useCreateCheckoutSes2[1];\n\n  var _useGetClassroomsQuer = useGetClassroomsQuery(),\n      _useGetClassroomsQuer2 = _slicedToArray(_useGetClassroomsQuer, 1),\n      _useGetClassroomsQuer3 = _useGetClassroomsQuer2[0],\n      data = _useGetClassroomsQuer3.data,\n      fetching = _useGetClassroomsQuer3.fetching;\n\n  var stripe = useStripe();\n  var elements = useElements();\n\n  if (fetching) {} else if (!data && !data.classrooms && data.classrooms.length == 0) {} else {\n    var index = data.classrooms.findIndex(function (room) {\n      if (room.id == number) {\n        return room;\n      }\n    });\n    classroom = data.classrooms[index];\n    classCard = /*#__PURE__*/_jsxDEV(Classroom, _objectSpread({}, classroom), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 21\n    }, _this);\n    info = /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Square, {\n        w: \"100%\",\n        h: \"50%\",\n        bg: \"indigo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(Flex, {\n        w: \"100%\",\n        p: \"2rem\",\n        direction: \"column\",\n        children: [/*#__PURE__*/_jsxDEV(Heading, {\n          as: \"h3\",\n          children: classroom.course.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(Text, {\n          as: \"sub\",\n          children: classroom.course.language.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 21\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true);\n    body = /*#__PURE__*/_jsxDEV(SimpleGrid, {\n      columns: 3,\n      mt: \"2rem\",\n      spacing: \"2rem\",\n      p: \"2rem\",\n      children: data.classrooms.map(function (value, mapIndex) {\n        if (index != mapIndex) {\n          return /*#__PURE__*/_jsxDEV(Classroom, _objectSpread(_objectSpread({}, value), {}, {\n            size: \"small\"\n          }), void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 32\n          }, _this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }, _this);\n\n    var _useIsPaidQuery = useIsPaidQuery({\n      pause: number == '-1',\n      variables: {\n        id: number\n      }\n    }),\n        _useIsPaidQuery2 = _slicedToArray(_useIsPaidQuery, 1),\n        paid = _useIsPaidQuery2[0];\n\n    if (paid.fetching) {} else if (!paid.data) {} else {\n      if (!paid.data.isPaid) {\n        formFunc = /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n            var res;\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    if (!(!stripe || !elements)) {\n                      _context.next = 2;\n                      break;\n                    }\n\n                    return _context.abrupt(\"return\");\n\n                  case 2:\n                    _context.next = 4;\n                    return checkout({\n                      id: classroom.course.id\n                    });\n\n                  case 4:\n                    res = _context.sent;\n                    console.log(res);\n\n                    if (res.data.createCheckout.stripeID) {\n                      stripe.redirectToCheckout({\n                        sessionId: res.data.createCheckout.stripeID\n                      });\n                    }\n\n                  case 7:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }));\n\n          return function formFunc() {\n            return _ref2.apply(this, arguments);\n          };\n        }();\n\n        var now = moment();\n        var max = moment(parseInt(classroom.time_start));\n        var min = moment(parseInt(classroom.time_start)).subtract(7, 'days');\n        console.log(now);\n        console.log(min);\n        console.log(max);\n\n        if (now >= min && now < max) {\n          buyButton = /*#__PURE__*/_jsxDEV(Box, {\n            mt: \"4rem\",\n            w: \"20%\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              w: \"100%\",\n              mr: \"4rem\",\n              colorScheme: \"blue\",\n              children: \"Comprar\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 25\n          }, _this);\n        } else {\n          buyButton = /*#__PURE__*/_jsxDEV(Box, {\n            mt: \"4rem\",\n            w: \"20%\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              w: \"100%\",\n              mr: \"4rem\",\n              colorScheme: \"gray\",\n              disabled: true,\n              children: \"No disponible\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 25\n          }, _this);\n        }\n      } else {\n        buyButton = /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"4rem\",\n          w: \"20%\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            w: \"100%\",\n            mr: \"4rem\",\n            color: \"teal\",\n            children: /*#__PURE__*/_jsxDEV(NextLink, {\n              href: \"./meeting/\".concat(classroom.link),\n              children: \"Ingresar\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 25\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 21\n        }, _this);\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(Layout, {\n      children: /*#__PURE__*/_jsxDEV(Formik, {\n        initialValues: {\n          classroom: pid\n        },\n        onSubmit: formFunc,\n        children: function children(_ref3) {\n          var values = _ref3.values,\n              isSubmitting = _ref3.isSubmitting;\n          return /*#__PURE__*/_jsxDEV(Form, {\n            children: /*#__PURE__*/_jsxDEV(Flex, {\n              direction: \"row\",\n              w: \"100wh\",\n              h: \"80vh\",\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                rounded: \"md\",\n                shadow: \"md\",\n                w: \"30%\",\n                h: \"80%\",\n                borderColor: \"gray.100\",\n                children: info\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 33\n              }, _this), /*#__PURE__*/_jsxDEV(Flex, {\n                ml: \"2rem\",\n                direction: \"column\",\n                w: \"100%\",\n                children: [/*#__PURE__*/_jsxDEV(Flex, {\n                  w: \"100%\",\n                  rounded: \"md\",\n                  shadow: \"md\",\n                  p: \"2rem\",\n                  children: [/*#__PURE__*/_jsxDEV(Box, {\n                    w: \"80%\",\n                    children: [/*#__PURE__*/_jsxDEV(Heading, {\n                      as: \"h4\",\n                      mb: \"2rem\",\n                      children: \"Clase actual\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 151,\n                      columnNumber: 45\n                    }, _this), classCard]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 41\n                  }, _this), buyButton]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 149,\n                  columnNumber: 37\n                }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                  rounded: \"md\",\n                  shadow: \"md\",\n                  children: body\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 157,\n                  columnNumber: 37\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 33\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 25\n          }, _this);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(Course, \"4AeVAX0mDWmi+GA8Z5v+5T0J+xU=\", false, function () {\n  return [useRouter, useCreateCheckoutSessionMutation, useGetClassroomsQuery, useStripe, useElements, useIsPaidQuery];\n});\n\n_c = Course;\nexport default withUrqlClient(urqlClient, {\n  ssr: true\n})(Course);\n\nvar _c;\n\n$RefreshReg$(_c, \"Course\");","map":{"version":3,"sources":["C:/Users/Usuario/Documents/Proyectos/apollo-academy/apollo-academy-web/pages/course/[pid].tsx"],"names":["Box","Button","Flex","Heading","Link","SimpleGrid","Square","Text","useElements","useStripe","Form","Formik","withUrqlClient","NextLink","useRouter","React","Classroom","Header","Layout","useCreateCheckoutSessionMutation","useGetClassroomsQuery","useIsPaidQuery","urqlClient","moment","Course","classroom","body","formFunc","buyButton","info","classCard","router","pid","query","number","checkout","data","fetching","stripe","elements","classrooms","length","index","findIndex","room","id","course","name","language","map","value","mapIndex","pause","variables","paid","isPaid","res","console","log","createCheckout","stripeID","redirectToCheckout","sessionId","now","max","parseInt","time_start","min","subtract","link","values","isSubmitting","ssr"],"mappings":"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","sourcesContent":["\r\nimport { Box, Button, Flex, Heading, Link, SimpleGrid, Square, Text } from \"@chakra-ui/react\";\r\nimport { useElements, useStripe } from \"@stripe/react-stripe-js\";\r\nimport { Form, Formik } from \"formik\";\r\nimport { withUrqlClient } from \"next-urql\";\r\nimport NextLink from 'next/link';\r\nimport { useRouter } from \"next/router\";\r\nimport React from \"react\";\r\nimport Classroom from \"../../components/Classroom\";\r\nimport { Header } from \"../../components/Header\";\r\nimport Layout from \"../../components/Layout\";\r\nimport { useCreateCheckoutSessionMutation, useGetClassroomsQuery, useIsPaidQuery } from \"../../generated/graphql\";\r\nimport { urqlClient } from \"../../utils/urqlClient\";\r\nimport moment from 'moment';\r\n\r\ninterface CourseProps { }\r\n\r\nconst Course: React.FC<CourseProps> = ({ }) => {\r\n    let classroom: typeof data.classrooms[0];\r\n    let body = null;\r\n    let formFunc = null;\r\n    let buyButton = null;\r\n    let info = null;\r\n    let classCard = null;\r\n\r\n    const router = useRouter();\r\n    const { pid } = router.query;\r\n    const number = typeof router.query.pid === 'string' ? router.query.pid : '-1';\r\n\r\n    const [, checkout] = useCreateCheckoutSessionMutation();\r\n    const [{ data, fetching }] = useGetClassroomsQuery();\r\n\r\n\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n\r\n\r\n\r\n    if (fetching) {\r\n\r\n    } else if (!data && !data.classrooms && data.classrooms.length == 0) {\r\n\r\n    } else {\r\n        let index = data.classrooms.findIndex((room) => {\r\n            if (room.id == number) {\r\n                return room;\r\n            }\r\n        })\r\n\r\n        classroom = data.classrooms[index];\r\n\r\n        classCard = <Classroom {...classroom} />;\r\n\r\n        info = (\r\n            <>\r\n                <Square w=\"100%\" h=\"50%\" bg=\"indigo\" />\r\n                <Flex w=\"100%\" p=\"2rem\" direction=\"column\">\r\n                    <Heading as=\"h3\">{classroom.course.name}</Heading>\r\n                    <br />\r\n                    <Text as=\"sub\">{classroom.course.language.name}</Text>\r\n                    <br />\r\n                </Flex>\r\n            </>\r\n        )\r\n\r\n        body = (\r\n            <SimpleGrid columns={3} mt=\"2rem\" spacing=\"2rem\" p=\"2rem\">\r\n                {data.classrooms.map((value, mapIndex) => {\r\n                    if (index != mapIndex) {\r\n                        return <Classroom {...value} size=\"small\" />\r\n                    }\r\n                })}\r\n            </SimpleGrid>\r\n        )\r\n\r\n        const [paid] = useIsPaidQuery({\r\n            pause: number == '-1',\r\n            variables: { id: number }\r\n        })\r\n        if (paid.fetching) {\r\n\r\n        } else if (!paid.data) {\r\n\r\n        } else {\r\n            if (!paid.data.isPaid) {\r\n                formFunc = async () => {\r\n                    if (!stripe || !elements) {\r\n                        return;\r\n                    }\r\n\r\n                    const res = await checkout({ id: classroom.course.id });\r\n                    console.log(res);\r\n                    if (res.data.createCheckout.stripeID) {\r\n                        stripe.redirectToCheckout({ sessionId: res.data.createCheckout.stripeID });\r\n                    }\r\n                }\r\n\r\n                let now = moment();\r\n                let max = moment(parseInt(classroom.time_start));\r\n                let min = moment(parseInt(classroom.time_start)).subtract(7, 'days');\r\n\r\n                console.log(now)\r\n                console.log(min)\r\n                console.log(max)\r\n\r\n                if(now >= min && now < max)\r\n                {\r\n                    buyButton = (\r\n                        <Box mt=\"4rem\" w=\"20%\">\r\n                            <Button type=\"submit\" w=\"100%\" mr=\"4rem\" colorScheme=\"blue\">Comprar</Button>\r\n                        </Box>\r\n                    )\r\n                }else{\r\n                    buyButton = (\r\n                        <Box mt=\"4rem\" w=\"20%\">\r\n                            <Button type=\"submit\" w=\"100%\" mr=\"4rem\" colorScheme=\"gray\" disabled>No disponible</Button>\r\n                        </Box>\r\n                    )\r\n                }\r\n            } else {\r\n                buyButton = (\r\n                    <Box mt=\"4rem\" w=\"20%\">\r\n                        <Link w=\"100%\" mr=\"4rem\" color=\"teal\">\r\n                            <NextLink href={`./meeting/${classroom.link}`}>\r\n                                Ingresar\r\n                            </NextLink> \r\n                        </Link>\r\n                    </Box>\r\n                )\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Header />\r\n            <Layout>\r\n                <Formik\r\n                    initialValues={{ classroom: pid }}\r\n                    onSubmit={formFunc}\r\n                >\r\n                    {({ values, isSubmitting }) => (\r\n                        <Form>\r\n                            <Flex direction=\"row\" w=\"100wh\" h=\"80vh\">\r\n                                <Box rounded=\"md\" shadow=\"md\" w=\"30%\" h=\"80%\" borderColor=\"gray.100\">\r\n                                    {info}\r\n                                </Box>\r\n                                <Flex ml=\"2rem\" direction=\"column\" w=\"100%\">\r\n                                    <Flex w=\"100%\" rounded=\"md\" shadow=\"md\" p=\"2rem\">\r\n                                        <Box w=\"80%\">\r\n                                            <Heading as=\"h4\" mb=\"2rem\">Clase actual</Heading>\r\n                                            {classCard}\r\n                                        </Box>\r\n\r\n                                        {buyButton}\r\n                                    </Flex>\r\n                                    <Box rounded=\"md\" shadow=\"md\">\r\n                                        {body}\r\n                                    </Box>\r\n                                </Flex>\r\n                            </Flex>\r\n                        </Form>\r\n                    )}\r\n                </Formik>\r\n            </Layout>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default withUrqlClient(urqlClient, { ssr: true })(Course);"]},"metadata":{},"sourceType":"module"}